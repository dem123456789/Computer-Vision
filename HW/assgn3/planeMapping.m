function [H] = planeMapping(X,P1,P2)
% x1 = [x1 ones(size(x1,1),1)];
% x2 = [x1 ones(size(x2,1),1)];
X1 = X(1,:)';
X2 = X(2,:)';
X3 = X(3,:)';
X4 = X(4,:)';
X5 = X(5,:)';
X6 = X(6,:)';
X7 = X(7,:)';
X8 = X(8,:)';
PI1 = [cross(X1-X3,X2-X3);-X3'*(cross(X1,X2))]';
PI2 = [cross(X3-X5,X4-X5);-X5'*(cross(X3,X4))]';
PI3 = [cross(X3-X7,X6-X7);-X7'*(cross(X3,X6))]';
PIs = [PI1./PI1(end);PI2./PI2(end);PI3./PI3(end)];
PIs = PIs(1:3,1:3);
pp1 = P1(3,:);
pp2 = P2(3,:);
pp1 = pp1(1:end-1)/pp1(end);
pp2 = pp2(1:end-1)/pp2(end);
c1 = size(pp1,2);
H = zeros(3*3,3);
for i=1:3
    PI = PIs(i,:);
    wixi = repmat(PI(:,3),1,c1).* pp1;
    yixi = repmat(PI(:,2),1,c1).* pp1;
    xixi = repmat(PI(:,1),1,c1).* pp1;
    A1 = [zeros(1,c1),-wixi,yixi;wixi,zeros(1,c1),-xixi];
    wixi = repmat(PI(:,3),1,c1).* pp2;
    yixi = repmat(PI(:,2),1,c1).* pp2;
    xixi = repmat(PI(:,1),1,c1).* pp2;
    A2 = [zeros(1,c1),-wixi,yixi;wixi,zeros(1,c1),-xixi];
    A = [A1;A2];
    [~,~,V] = svd(A);
    V_last = V(:,end);
    H((i-1)*3+1:i*3,:) = reshape(V_last,c1,c1)';
end
end